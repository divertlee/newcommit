# ARP协议

地址解析协议，即ARP（Address Resolution Protocol），是根据IP地址获取物理地址的一个TCP/IP协议。

在网络通信中，知道目标主机的IP地址，可以将数据报文发送到目标主机所在的局域网，实际上是将数据报文发送到管理该局域网的路由器。然后由路由器将数据报文转发到目标主机上。在局域网中通信需要先知道目标主机的物理地址，而此时只知道目标主机的IP地址，并不知道该主机的mac地址。因此在局域网中正式通信之前，需要根据目标主机的IP地址，获取到mac地址。**ARP协议就是通过IP地址获取mac地址这样的一个协议**。

### ARP协议的作用

> ARP协议建立了主机IP和MAC地址的映射关系。
>
> * 数据从应用层自定向下交付时，一层层对数据报文进行封装，数据报文先是经过网络层的IP地址，才经过数据链路层的MAC地址，



源主机只知道目的IP，而根据目的IP能够找到目标主机所处的局域网，但是不知道目标主机的MAC地址。因此需要在目的主机的路由器中，根据目的IP得到目标主机的MAC地址，进而能够将报文发送到目标主机。根据目的IP获得目标主机的技术叫做ARP协议。

主机A要与同局域网的主机B通信，但主机A不知道主机B的mac地址时，主机A会在局域网中发布一个广播，请求主机B的mac地址。主机B受到后会回复一个相应，响应自身的mac地址给主机A。

主机A发送ARP请求到局域网中，然而不知道目标主机的mac地址，因此在ARP请求中的以太网目的地址填充全F，表示该字段未知。向下交付给数据链路层，以太网协议需要对该请求进行封装，封装的报头中的以太网目的地址也填全F然后将mac帧发送到局域网中。

局域网内的主机都能够收到该请求，主机都需要接收然后解包交付到ARP协议。首先看ARP报文的op字段，若字段为1表示ARP请求，然后查看目的IP地址，若IP地址不是本主机IP地址，则直接丢弃。若目的IP地址是本主机IP地址，就对该请求回复响应。向ARP报文目的以太网地址中填充主机mac地址，并将op字段改为2表示该报文是ARP响应。向下交付给数据链路层。以太网协议要对ARP报文做封装，封装完后将报文发送到局域网中。

主机A收到mac该mac帧后，在数据链路层对mac帧做解包，向上交付给ARP协议，首先查看op字段，op字段为2说明该ARP报文是ARP响应，然后去查看源IP地址，是本主机地址，说明该ARP响应是发送给本主机的。根据ARP响应的发送端以太网地址获取到主机B的mac地址。





arp缓存表：arp请求和响应较为繁琐，因此计算机中会将该请求和响应暂时缓存起来。下次收到其他主机的arp请求时，直接去到缓冲表中拿到对应响应。局域网中由于主机号是要被路由器管理的，因此会出现局域网中的主机连接上网络，路由器给该主机分配完IP地址，接着该主机退出了该网络，接着又连接上，这时该主机分配到的IP地址与之前可能是不同的，即同一台主机短时间内分配到的IP地址会改变，因此。。。



知道主机mac地址但是不知道IP地址，可以直接发RARP请求给该主机，主机收到后直接将mac帧向上交付给RARP，向RARP报文中填充IP地址，然后封装为RARP响应，接着向下交付给数据链路层，封装成mac帧发送回给目标主机即可。

ping 



1. arp收到应答时，会以最新的应答为主。
2. arp欺骗。向主机发送arp响应洪水，让主机修改arp缓冲表中的IP地址和mac地址。向路由器中发送arp请求洪水，让路由器修改arp缓存表中的IP地址和mac地址。这样发起arp欺骗的主机就能成为主机和路由器的中间人。



# DNS

#### DNS背景

www.baidu.com

.com:一级域名，com表示该域名用于商业盈利。org用于非盈利

baidu：二级域名，通常是企业名