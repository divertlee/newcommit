# MAC协议

1. 在同一个局域网的主机，可以直接通信。
2. 每台主机都必须具备唯一的标识符，即mac地址。mac地址一共6字节48位，该地址是配备在网卡上的，且是全球唯一。
3. mac报头具有目的mac地址，源mac地址，和mac帧类型（0800指IP数据报类型，0806指ARP数据包类型，8035指RARP类型，然后是46字节~1500字节的有效载荷，最后是四字节的校验码CRC。
4. 通过ifconfig查看ether后接的就是mac地址
5. 在局域网中，一台主机发送的消息，局域网中的所有主机都能够接收到，但是在数据链路层就能够对目的mac地址进行丢弃或者接收向上交付操作。
6. 混杂模式：网卡具有混杂模式，不放弃任何数据帧，无论收到什么报文都接收并且向上交付，不对数据做丢弃操作。即抓包数据的原理。
7. 实际上在硬件上传输mac帧是通过光电信号传播，而传播过程中若会出现两个及以上的mac帧在局域网中时会发送数据碰撞，碰撞后的mac帧就容易发送数据丢失，因此mac帧若发生了碰撞，一般情况下是要被目的主机丢弃的。即一个局域网就是一个碰撞域，如果同一时刻局域网中存在多个消息在传播，就会发生数据碰撞，产生无效数据。因此在同一个时刻只允许一台数据在发生数据。而避免数据碰撞的手段是主机的碰撞检测和避免碰撞算法。
8. 局域网目前有两种，一是令牌环网，一个局域网分配有一个令牌，具备令牌的主机才能往局域网中发送数据，发送完后会将令牌转让给下一台主机。可以认为局域网是一种灵界资源，往局域网中发送数据的动作是临界区，而令牌就是一个保护临界区的互斥锁，具备锁的主机才能进入临界区访问临界资源。
9. 二是以太网，以太网采用的是主机的碰撞检测和避免碰撞算法，如果发生了数据碰撞，那么发送该碰撞的主机就需要等待一段时间再发送，等待期间，没有发生数据碰撞的主机可以往局域网中发送数据，一定程度上避免了数据碰撞。而光电信号的传播数据极快，这种做法基本上能够避免局域网的数据碰撞问题。该做法与令牌环网的做法殊途同归。
10. 保持局域网消息正常发送就是保证主机都遵守主机的碰撞检测和避免碰撞算法，因此破坏局域网的手段就是不遵守该算法，不断的往局域网中发送垃圾数据，对局域网中的数据进行碰撞破坏。、
11. 在网络层中使用的中间设备是路由器，在数据链路层中使用的中间设备是交换机。交换机的作用：其一：**识别局部性的碰撞，对碰撞过的数据不做转发**。交换机会放置在局域网中，对局域网进行局部划分。例如左局部的主机需要向右局部的主机发送数据时，需要通过交换机进行转发。若转发的数据在左局部网已经被碰撞了，交换机不做转发，减少右局域网的数据碰撞概率，保护了右局部网。其二：**不对局域网中的局部域的数据进行转发**。例如m1主机向m3主机发送数据，理论上局域网中的所有数据都会接收到该数据如何在数据链路层中做相应处理。而 m1主机和m3主机存在局域网中的同一个局部域，那么交换机不会将该数据转发到另一个局部域中，减少了另一个局部域的数据碰撞的几率。
12. 局域网本身名字也赋予了该网域大小意义。局域网太大，其包含的主机数量越多，那么数据碰撞的几率就越大。
13. MTU可以通过ifconfig查询。
14. MTU大小46~1500（单位是字节）。而主机会规定MTU的大小，实际上路由器也会规定MTU的大小，因此会出现主机分片好的IP数据包在路径上经过路由器时，会被路由器再次进行分片，使得IP报文更小。因此三位标志位中存在一位禁止分片标志位。如果这次网络通信要求数据吞吐量大的话，就设置该禁止分片标志位。若路径上的路由器想要对该IP报文分片时，由于报文禁止分片，因此该报文会被路由器丢弃。然后触发重传机制，源IP重新选择发送路径，重复多次找到一条吞吐量最大的通信路径。而本身IP数据包就比较小的就可以选择路由器MTU较小的路径，即吞吐量较小的路径，吞吐量越小，除了发送数据碰撞的几率越小以外，通信速度也越快，因此请求和相应的速度就越快。
15. 由于数据链路规定了MTU最大为1500字节，因此网络层IP协议就需要规定有效载荷最大为1480，因此网络层就需要规定报文的有效载荷最大为1460.而1460为S=MSS(MAX SEGMENT SIZE—最大报文长度)即为用户所能一次性发送的最大数据大小。

# ARP协议

源主机只知道目的IP，而根据目的IP能够找到目标主机所处的局域网，但是不知道目标主机的MAC地址。因此需要在目的主机的路由器中，根据目的IP得到目标主机的MAC地址，进而能够将报文发送到目标主机。根据目的IP获得目标主机的技术叫做ARP协议。